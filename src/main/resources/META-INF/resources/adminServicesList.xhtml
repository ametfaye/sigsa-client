<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:p="http://primefaces.org/ui" xmlns:pe="http://primefaces.org/ui/extensions" xmlns:ui="http://java.sun.com/jsf/facelets">
  <h:head>
    <title>SIGMA | Gestion des services</title>
    <h:outputStylesheet name="css/login.css" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" />
    <!-- Sweet Alert -->
    <link href="assets/plugins/sweet-alert2/sweetalert2.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/animate/animate.css" rel="stylesheet" type="text/css" />
    <!-- DataTables -->
    <link href="assets/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/jquery-ui.min.css" rel="stylesheet" />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/metisMenu.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/plugins/daterangepicker/daterangepicker.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
    <style>
      breadcrumb-item.active {
        color: #bdb1ab ! important;
      }

      .badge.badge-soft-success {
        color: #354840 !important;
      }

      .badge.badge-soft-warning {
        color: #252118 !important;
      }

      .badge.badge-soft-danger {
        color: #564448 !important;
      }

      .select2-container--default .select2-selection--single .select2-selection__rendered {
        color: #444;
        line-height: 28px;
        display: block;
        width: 100%;
        height: calc(1.8em + 0.75rem + 2px);
        padding: 0.375rem 0.75rem;
        font-size: .8125rem;
        font-weight: 400;
        line-height: 1.8;
        color: #303e67;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #e3ebf6;
        border-radius: 0.25rem;
      }

      .select2-container--default .select2-selection--single {
        background-color: red;
        border: 1px solid red;
        border-radius: 4px;
      }
    </style>
  </h:head>
  <h:body class="dark-sidenav">
    <!-- Left Sidenav -->
    <ui:include src="./includes/leftSideNav.xhtml" />
    <!-- end left-sidenav-->
    <div class="page-wrapper">
      <!-- Top Bar Start -->
      <ui:include src="./includes/topBar.xhtml" />
      <!-- Top Bar End -->
      <!-- Page Content-->
      <div class="page-content">
        <h:form class="form-horizontal" prependId="false">
          <div class="container-fluid">
            <!-- Page-Title -->
            <div class="row mb-2">
              <div class="col-md-12">
                <nav class="navbar navbar-expand-lg navbar-light bg-light mt-3">
                  <a class="navbar-brand" href="#">
                    <img src="assets/images/logo-sm.png" height="26" alt="" class="mr-1" />
                  </a>
                  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                      <li class="nav-item">
                        <a class="nav-link" href="#">Référentiels / Services / Gestion des services</a>
                      </li>
                    </ul>
                    <!--end navbar-nav-->
                    <div class="pull-right">
                      <ul class="navbar-nav mr-auto">
                        <li class="nav-item ">
                          <a class="nav-link" href="#">#{ServiceController.connectedUserDetails.entitePublique} / #{ServiceController.connectedUserDetails.service}
                            / #{ServiceController.connectedUserDetails.sousService}</a>
                        </li>
                      </ul>
                    </div>
                    <!--end form-->
                  </div>
                  <!--end navbar-collapse-->
                </nav>
              </div>
            </div>
            <!--end row-->
            <!-- end page title end breadcrumb -->
            <div class="row">
              <div class="col-12">
                <div class="card" style="background-image: url(images/auth-bg.png)">
                  <div class="card-body">
                    <h4 style="text-align :center">
                      <i class="las la-list text-secondary font-22 align-middle mr-2"></i>Gestion des services
                    </h4>
                    <hr />
                    <div class="row" style="background: #f1f5f9; margin-left : 1px; margin-right : 1px ;">
                      <div class="col-md-5" style=" margin-top : 30px">
                        <div class="form-group row">
                          <label for="entitePublique" class="col-sm-6 col-form-label text-right">Entité Publique</label>
                          <div class="col-sm-6">
                            <h:selectOneMenu value="#{ServiceController.serviceToCreateEtablissementId}" styleClass="custom-select" id="select-etablissement" 
                            style="box-shadow : inset 0 2px 2px white ;  height: 45PX ! important ; ">
                              <f:selectItem itemLabel="Sélectionner une entité publique" itemValue="0" />
                              <f:selectItems value="#{ServiceController.entitePublicRefs}" var="d" itemLabel="#{d.libelle}" itemValue="#{d.redId}" />
                            </h:selectOneMenu>
                          </div>
                        </div>
                        <!--end form-group-->
                      </div>
                      <div class="col-md-5" style="margin-top : 30px">
                        <div class="form-group row">
                          <label for="codeService" class="col-sm-4 col-form-label text-right">Code du service</label>
                          <div class="col-sm-8">
                            <h:inputText styleClass="form-control" value="#{ServiceController.newServiceDto.code}" />
                          </div>
                          <!--end form-group-->
                        </div>
                        <div class="form-group row">
                          <label for="nomService" class="col-sm-4 col-form-label text-right">Nom du service</label>
                          <div class="col-sm-8">
                            <h:inputText styleClass="form-control" value="#{ServiceController.newServiceDto.libelle}" />
                          </div>
                        </div>
                      </div>
                      <div class="button-items" style="margin-left: 10px; margin-top : 50px">
                        <button type="button" class="btn btn-success waves-effect waves-light">
                          <i class="las la-plus" title=""></i>
                          <h:commandLink action="#{ServiceController.createService()}" style="color: #ffffff;" ajax="false" value="Créer le service"></h:commandLink>
                        </button>
                      </div>
                    </div>
                    <br />
                    <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                      <thead>
                        <tr>
                          <th colspan="4" style="text-align : center"> Liste des services</th>
                        </tr>
                        <tr>
                          <th> Code</th>
                          <th> Entité Publique</th>
                          <th> Nom du service</th>
                          <th> Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <p:repeat value="#{ServiceController.services}" var="service">
                          <tr>
                            <td>#{service.code}</td>
                            <td>-</td>
                            <td>#{service.libelle}</td>
                            <td class="text-center">
                              <a href="#" data-toggle="modal" data-target="#updateServiceModal-#{service.srvId}">
                                <i class="las la-pen text-warning font-18" title="Modifier"></i>
                              </a>
                              <a href="#" data-toggle="modal" data-target="#deleteServiceModal-#{service.srvId}">
                                <i class="las la-trash-alt text-danger font-18" title="Supprimer"></i>
                              </a>
                              <div class="modal fade bd-example-modal-sm" id="deleteServiceModal-#{service.srvId}" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-md" role="deleteService">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h6 class="modal-title m-0" id="mySmallModalLabel">Confirmation de la suppression</h6>
                                      <button type="button" class="close " data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">
                                          <i class="la la-times"></i>
                                        </span>
                                      </button>
                                    </div>
                                    <!--end modal-header-->
                                    <div class="modal-body text-center">
                                      <h4 class="mb-1">Êtes-vous sûr de vouloir supprimer le service</h4>
                                      <br />
                                      <h5>#{service.libelle} ? </h5>
                                    </div>
                                    <!--end modal-body-->
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary btn-xs" data-dismiss="modal">Annuler</button>
                                      <button type="button" class="btn btn-primary btn-xs">
                                        <h:commandLink action="#{ServiceController.deleteService(service.srvId)}" style="color: #ffffff;" ajax="false" value="Confirmer"></h:commandLink>
                                      </button>
                                    </div>
                                    <!--end modal-footer-->
                                  </div>
                                  <!--end modal-content-->
                                </div>
                                <!--end modal-dialog-->
                              </div>
                              <!--end modal-->
                              <div class="modal fade bd-example-modal-sm" id="updateServiceModal-#{service.srvId}" tabindex="-1" role="dialog" aria-labelledby="updateService" aria-hidden="true">
                                <div class="modal-dialog modal-md" role="updateService">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <h6 class="modal-title m-0" id="mySmallModalLabel">Modification du service #{service.libelle}</h6>
                                      <button type="button" class="close " data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">
                                          <i class="la la-times"></i>
                                        </span>
                                      </button>
                                    </div>
                                    <!--end modal-header-->
                                    <div class="modal-body text-center">
                                      <div class="row">
                                        <div class="col-lg-8 center">
                                          <div class="form-group row">
                                            <label class="col-sm-4 col-form-label text-left">Nouveau code</label>
                                            <div class="col-sm-8">
                                              <h:inputText value="#{ServiceController.updateServiceDto.code}" name="code" class="form-control" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-lg-8 center">
                                          <div class="form-group row">
                                            <label class="col-sm-4 col-form-label text-left">Nouveau libellé</label>
                                            <div class="col-sm-8">
                                              <h:inputText value="#{ServiceController.updateServiceDto.libelle}" name="libelle" class="form-control" />
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <!--end modal-body-->
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-secondary btn-xs" data-dismiss="modal">Annuler</button>
                                      <button type="button" class="btn btn-primary btn-xs">
                                        <h:commandLink action="#{ServiceController.updateService(service.srvId)}" style="color: #ffffff;" ajax="false" value="Confirmer"></h:commandLink>
                                      </button>
                                    </div>
                                    <!--end modal-footer-->
                                  </div>
                                  <!--end modal-content-->
                                </div>
                                <!--end modal-dialog-->
                              </div>
                              <!--end modal-->
                            </td>
                          </tr>
                        </p:repeat>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
              <!-- end col -->
            </div>
            <button style="display: none;" type="button" id="create-service-topright-success">show alert</button>
            <h:inputText value="#{ServiceController.createServiceSuccesMsg}" id="create-service-succes-text" style="display: none;" />
            <button style="display: none;" type="button" id="create-service-topright-error">show alert</button>
            <h:inputText value="#{ServiceController.createServiceErreurMsg}" id="create-service-error-text" style="display: none;" />
            <button type="button" style="display: none;">
              <h:commandLink id="reset-error-msgs" value="Enregistrer" style="color: #ffffff;">
                <p:ajax event="click" update="create-service-error-text create-service-succes-text" process="@this" listener="#{ServiceController.resetErrorMsgs()}"></p:ajax>
              </h:commandLink>
            </button>
            <!-- end row -->
          </div>
          <!-- container -->
          <ui:include src="./includes/footer.xhtml" />
          <!--end footer-->
        </h:form>
      </div>
      <!-- end page content -->
    </div>
    <!-- end page-wrapper -->
  </h:body>
  <!-- jQuery  -->
  <script src="assets/js/jquery.min.js"></script>
  <script src="assets/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/metismenu.min.js"></script>
  <script src="assets/js/waves.js"></script>
  <script src="assets/js/feather.min.js"></script>
  <script src="assets/js/simplebar.min.js"></script>
  <script src="assets/js/jquery-ui.min.js"></script>
  <script src="assets/js/moment.js"></script>
  <script src="assets/plugins/daterangepicker/daterangepicker.js"></script>
  <script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
  <script src="assets/plugins/datatables/dataTables.bootstrap4.min.js"></script>
  <!-- Sweet-Alert  -->
  <script src="assets/plugins/sweet-alert2/sweetalert2.min.js"></script>
  <script src="assets/pages/jquery.sweet-alert.init.js"></script>
  <!-- App js -->
  <script src="assets/js/app.js"></script>
  <link href="assets/plugins/select2/select2.min.css" rel="stylesheet" type="text/css" />
  <script src="assets/plugins/select2/select2.min.js" type="text/javascript"></script>
  <script>
    $('#datatable').DataTable({
      "language": {
        "sProcessing": "Traitement en cours ...",
        "sLengthMenu": "Afficher _MENU_ lignes",
        "sZeroRecords": "Aucun résultat trouvé",
        "sEmptyTable": "Aucune donnée disponible",
        "sInfo": "Lignes _START_ à _END_ sur _TOTAL_",
        "sInfoEmpty": "Aucune ligne affichée",
        "sInfoFiltered": "(Filtrer un maximum de_MAX_)",
        "sInfoPostFix": "",
        "sSearch": "Chercher:",
        "sUrl": "",
        "sInfoThousands": ",",
        "sLoadingRecords": "Chargement...",
        "oPaginate": {
          "sFirst": "Premier",
          "sLast": "Dernier",
          "sNext": "Suivant",
          "sPrevious": "Précédent"
        },
        "oAria": {
          "sSortAscending": ": Trier par ordre croissant",
          "sSortDescending": ": Trier par ordre décroissant"
        }
      }
    });
    $(document).ready(function() {
      if ($('#create-service-succes-text').val() !== '') {
        $('#create-service-topright-success').click();
        $('#reset-error-msgs').click();
      }
      if ($('#create-service-error-text').val() !== '') {
        $('#create-service-topright-error').click();
        $('#reset-error-msgs').click();
      }
    });
    jQuery(document).ready(function() {
      $("#select-etablissement").select2();
    });
  </script>
</html>